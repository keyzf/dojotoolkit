<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Dojox Rolling List Test</title>

	<style type="text/css">
		@import "../../../dojo/resources/dojo.css";
		@import "../../../dijit/tests/css/dijitTests.css";
	</style>

	<!-- required: a default dijit theme: -->
	<link id="themeStyles" rel="stylesheet" href="../../../dijit/themes/tundra/tundra.css">
	
	<!-- the additional styles for the widget -->
	<link id="widgetStyle" rel="stylesheet" href="../RollingList/RollingList.css">
	
	<!-- required: dojo.js -->
	<script type="text/javascript" src="../../../dojo/dojo.js"
		djConfig="parseOnLoad: true, isDebug: true"></script>
	
	<!-- not needed, for testing alternate themes -->
	<script type="text/javascript" src="../../../dijit/tests/_testCommon.js"></script>

	<script language="JavaScript" type="text/javascript">
		dojo.require("dojo.data.ItemFileWriteStore");
		dojo.require("dojox.widget.RollingList");
		dojo.require("dijit.form.Button");
		dojo.require("dojo.parser");	// scan page for widgets and instantiate them
		
		dojo.declare("dojox.widget.RollingStore", dojo.data.ItemFileWriteStore, {
			getLabel: function(item){
				return this.inherited(arguments) + " (" + this.getValue(item, "type") + ")";
			}
		});

		addedT = false;
		addedD = false;
		addedA = false;
		removedC = false;
		changedD = false;
		isBig = true;
		
		addTijuana = function(){
			if(addedT){ 
				console.log("Tijuana is already added");
				return; 
			}
			addedT = true;
			continentStore.fetchItemByIdentity({identity: "Mexico", onItem: function(i){
				continentStore.newItem({name: "Tijuana", type: "city"}, 
										{parent: i, attribute: "children"});
				continentStore.save();
			}});
		}
		addDC = function(){
			if(addedD){ 
				console.log("Washington DC is already added");
				return; 
			}			
			addedD = true;
			continentStore.fetchItemByIdentity({identity: "United States of America", onItem: function(i){
				continentStore.newItem({name: "Washington DC", type: "city"}, 
										{parent: i, attribute: "children"});
				continentStore.save();
			}});
		}
		addAntarctica = function(){
			if(addedA){ 
				console.log("Antarctica is already added");
				return; 
			}
			continentStore.newItem({name: "Antarctica", type: "continent"});
			addedA = true;
		}
		removeTijuana = function(){
			if(!addedT){ 
				console.log("Tijuana is not yet added");
				return; 
			}
			addedT = false;
			continentStore.fetchItemByIdentity({identity: "Tijuana", onItem: function(i){
				continentStore.deleteItem(i);
				continentStore.save();
			}});
		}
		removeCanada = function(){
			if(removedC){ 
				console.log("Canada is already removed");
				return; 
			}			
			removedC = true;
			continentStore.fetchItemByIdentity({identity: "Canada", onItem: function(i){
				continentStore.deleteItem(i);
			}});
		}
		changeDC = function(){
			if(!addedD){ 
				console.log("Washington DC is not yet added");
				return; 
			}			
			if(changedD){ 
				console.log("Washington DC is already changed");
				return; 
			}			
			changedD = true;
			continentStore.fetchItemByIdentity({identity: "Washington DC", onItem: function(i){
				continentStore.setValue(i, "type", "district");
			}});
		}
		removeDC = function(){
			if(!addedD){
				console.log("Washington DC is not yet added");
				return;
			}
			changedD = false;
			addedD = false;
			continentStore.fetchItemByIdentity({identity: "Washington DC", onItem: function(i){
				continentStore.deleteItem(i);
				continentStore.save();
			}});
			
		}
		doResize = function(){
			var newSize = isBig ? {w: 340, h: 100} : {w: 500, h: 300};
			dijit.byId("myList").resize(newSize);
			isBig = !isBig;
		}
	</script>

</head>
<body class="tundra">

	<h1 class="testTitle">Dojox Rolling List Test</h1>

	<div dojoType="dojox.widget.RollingStore" jsId="continentStore" 
		url="../../../dijit/tests/_data/countries.json">
	</div>
	
	<h3>Rolling List - <input type="text" id="clickWatch" disabled value="clicked item..."></h3>
	<div dojoType="dojox.widget.RollingList" id="myList" store="continentStore"
		query="{type:'continent'}">
		<script type="dojo/method" event="onItemClick" args="item,pane,children">
			dojo.byId("clickWatch").value = this.store.getIdentity(item);
		</script>
		<script type="dojo/method" event="getPaneForItem" args="item,parentPane,children">
			var ret = this.inherited("getPaneForItem", arguments);

			if(!ret){
				ret = new dojox.widget._StoreBasedRollingListPane({parentWidget: this,
									store: this.store,
									items: [item],
									parentPane: parentPane,
									onItems: function(){
										this._setContentAndScroll("Details for " + this.store.getLabel(this.items[0]));
										this._onLoadHandler();
									}});
			}
			return ret;
		</script>
	</div>
	<hr>
	<button dojoType="dijit.form.Button" onClick="doResize()">Resize widget</button>
	<hr>
	<button dojoType="dijit.form.Button" onClick="addTijuana()">Add Item To Mexico (Tijuana)</button>
	<button dojoType="dijit.form.Button" onClick="removeTijuana()">Remove Tijuana</button><br>
	<button dojoType="dijit.form.Button" onClick="addDC()">Add Item To USA (Washington DC)</button>
	<button dojoType="dijit.form.Button" onClick="changeDC()">Change Washington DC</button>
	<button dojoType="dijit.form.Button" onClick="removeDC()">Remove Washington DC</button><br>
	<button dojoType="dijit.form.Button" onClick="addAntarctica()">Add Item To Top-level (Antarctica)</button><br>
	<button dojoType="dijit.form.Button" onClick="removeCanada()">Remove Canada</button>
</body>
</html>
